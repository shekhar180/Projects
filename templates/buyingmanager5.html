{% extends "extend.html" %}
{% block tittle %}Buying Manager - ECOMMFLOW{% endblock tittle %}
{% block css %}
<!-- Plugins css -->
<!-- <link href="static/libs/flatpickr/flatpickr.min.css" rel="stylesheet" type="text/css" />
<link href="static/libs/bootstrap-colorpicker/bootstrap-colorpicker.min.css" rel="stylesheet" type="text/css" />
<link href="static/libs/clockpicker/bootstrap-clockpicker.min.css" rel="stylesheet" type="text/css" />
<link href="static/libs/bootstrap-datepicker/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css" /> -->

<!-- third party css -->
<link href="static/libs/datatables/dataTables.bootstrap4.css" rel="stylesheet" type="text/css"/>
<link href="static/libs/datatables/responsive.bootstrap4.css" rel="stylesheet" type="text/css"/>
<link href="static/libs/datatables/buttons.bootstrap4.css" rel="stylesheet" type="text/css"/>
<link href="static/libs/datatables/select.bootstrap4.css" rel="stylesheet" type="text/css"/>
<!-- third party css end -->

<!-- flat picker css -->
<link href="static/libs/flatpickr/flatpickr.min.css" rel="stylesheet" type="text/css"/>

<!-- upper dropdown datepicker css -->
<link href="static/libs/clockpicker/bootstrap-clockpicker.min.css" rel="stylesheet" type="text/css"/>

<link href="static/libs/bootstrap-datepicker/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css"/>
<!--https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/css/bootstrap-datepicker3.css-->
<!-- custom css -->
<link href="static/css/buyingmanager.css" rel="stylesheet" type="text/css">

<link href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
<style>
span.select2.select2-container.select2-container--default.select2-container--focus {
	width: 100% !important;
}

select {
         border: none;
    }

li.select2-selection__choice {
	color: #000 !important;
}

.select2-selection__rendered {
	width: 350px !important;
}

.p-datepicker {
	border: none !important;
}

.p-datepicker:focus {
	border: 1px solid;
}

select {
	border: none;
}

.button-arrow {
    background-color: Transparent;
    background-repeat:no-repeat;
    border: none;
    cursor:pointer;
    overflow: hidden;
    outline:none;
}

.button-arrow:hover{color:blue;}

.round-button{
  min-width: 30px;
  max-width:50px;
  text-decoration: none;
  display: inline-block;
  outline: none;
  cursor: pointer;
  border-style: none;
  color: white;
  background-color: #3498db;
  border-radius: 100%;
  overflow: none;
  text-align: center;
  padding:0;
  margin-right: 4px;
}

.round-button:before {
  content:'';
  display:inline-block;;
  vertical-align:middle;
  padding-top:100%;
}

.round-button span {
  display:inline-block;
  vertical-align:middle;
  max-width:90%;
}

.round-button:active{
  background-color: #2980b9;
}

.close_button{
    padding: 17px !important;
    padding-top: 35px !important;
    right: 0px;
    position: absolute;
}

.close_button:hover{color:red;}

button.active i { color: red; }

table.dataTable tbody > tr.selected, table.dataTable tbody > tr > .selected {
      color: #000;
      background-color: #f1f5f7;
   }

   table.dataTable tbody>tr.selected td, table.dataTable tbody>tr>.selected td {
      border: 1px solid #dee2e6;
   }

.switch {
	position: relative;
	display: inline-block;
	width: 60px;
	height: 34px;
}

.switch input {
	opacity: 0;
	width: 0;
	height: 0;
}

input:checked+.slider {
	background-color: #2196F3;
}

input:focus+.slider {
	box-shadow: 0 0 1px #2196F3;
}

input:checked+.slider:before {
	-webkit-transform: translateX(26px);
	-ms-transform: translateX(26px);
	transform: translateX(26px);
}

.slider {
	position: absolute;
	cursor: pointer;
	width: 56px;
	height: 28px;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background-color: #ccc;
	-webkit-transition: .4s;
	transition: .4s;
}

.slider:before {
	position: absolute;
	content: "";
	height: 18px;
	width: 18px;
	left: 7px;
	bottom: 6px;
	background-color: white;
	-webkit-transition: .4s;
	transition: .4s;
}

/* CSS for input type number */
/* Chrome, Safari, Edge, Opera */
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Firefox */
input[type=number] {
  -moz-appearance: textfield;
}
/*--------------------------*/

/* Rounded sliders */

.slider.round {
	border-radius: 34px;
}

.slider.round:before {
	border-radius: 50%;
}

.hd3 {
	border: 0;
	background: transparent;
	color: #6c757d;
}

.hd3:hover {
	background: #fff;
	color: #000;
}

.boxline1 {
    border-right: 1px solid #000;
    padding-right: 12px;
}

@media (min-width: 320px) and (max-width: 767px) {
	.boxline1 {
		border-right: none;
	}
	.col-sm-2 {
		max-width: none;
	}
}

.modal-cusm {
	margin-top: -50px;
	margin-bottom: 25px;
}

@media only screen and (min-device-width: 768px) and (max-device-width: 1024px) {
	.col-md-2 {
		max-width: none;
	}
}

.row-font-icon11 {
	padding-right: 10px;
	padding-left: 4px;
}

.row-font-icon11 i {
	font-size: 16px;
	font-weight: 600;
}

.row-font-downarrow {
	padding-left: 2px;
}

.row-font-downarrow i {
	font-size: 20px;
	font-weight: 600;
}
#snackbar {
	visibility: hidden;
	min-width: 250px;
	margin-left: -125px;
	background: #f7b84b !important;
	z-index: 999 !important;
	color: #000 !important;
	text-align: center;
	border-radius: 2px;
	padding: 16px;
	position: fixed;
	z-index: 1;
	left: 50%;
	top: 30px;
	font-size: 17px;
}

#snackbar.show {
    z-index: 10000!important;
	visibility: visible;
	-webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
	animation: fadein 0.5s, fadeout 0.5s 2.5s;
}

@-webkit-keyframes fadein {
	from {
		top: 0;
		opacity: 0;
	}
	to {
		top: 30px;
		opacity: 1;
	}
}

@keyframes fadein {
	from {
		top: 0;
		opacity: 0;
	}
	to {
		top: 30px;
		opacity: 1;
	}
}

@-webkit-keyframes fadeout {
	from {
		top: 30px;
		opacity: 1;
	}
	to {
		top: 0;
		opacity: 0;
	}
}

@keyframes fadeout {
	from {
		top: 30px;
		opacity: 1;
	}
	to {
		top: 0;
		opacity: 0;
	}
}

#showcustomdate{
    position: relative;
    left: 11rem;
    top: 25px;
    border: 1px solid;
    padding: 5px;
    border-radius: 5px;
    display:none;
}

#showselectedbox{
    position: relative;
    left: 12rem;
    top: 25px;
    border: 1px solid;
    border-radius: 5px;
    padding: 4px;
    display:none;
}

/* CSS FOR UI DATEPICKER */
.ui-widget-header {
	border: none !important;
	background: transparent !important;
}

.ui-state-default,
.ui-widget-content .ui-state-default {
	border-radius: 4px !important;
	border: none !important;
}

/*
.ui-state-highlight,
.ui-widget-content .ui-state-highlight {
	background: #6658dd!important;
	color: #fff;
}*/

.ui-datepicker td a {
	text-align: center;
}

.ui-widget-content {
	border: none;
	background: #ffffff;
	color: #212529;
	font-size: 16px;
	font-weight: initial;
	line-height: 1.5;
}

.ui-widget {
	font-family: Nunito, sans-serif;
}

.ui-widget.ui-widget-content {
	border: none;
}

.ui-datepicker {
	width: 13em;
}

.bootstrap-select .inner {
    overflow-y: auto !important;
}

/* Show Loader CSS */
.dataTables_processing {
        top: 0px !important;
        left: 0px !important;
        width: 100% !important;
        margin-left: 0px !important;
        margin-top: 0px !important;
        z-index: 80 !important;
        padding: 27em 0 !important;
        overflow-y: hidden;
}
@keyframes spinner {
  to {transform: rotate(360deg);}
}

.spinner{
    width:100px !important;
    height:100px !important;
    top: -150px !important;
}

.spinner:before {
  box-sizing: border-box;
  position: absolute;

  left: 50%;
  width:100%;
  height: 20px;
  margin-top: -10px;
  margin-left: -10px;
  border-radius: 50%;
  border: 2px solid #ccc;
  border-top-color: #333;
  z-index:9999;
  animation: spinner .6s linear infinite;
}
/* Show Loader CSS CLOSED */
</style>
{% endblock css %}

{% block js %}

<!-- Bootstrap Tables js -->
<!-- <script src="static/libs/bootstrap-table/bootstrap-table.min.js"></script> -->
<!-- Init js -->
<!-- <script src="static/js/pages/bootstrap-tables.init.js"></script> -->

<!-- bootstrap filter js -->
<script src="static/libs/bootstrap-select/bootstrap-select.min.js"></script>


<!---------- cell editable js ---------------->
<!-- https://stackoverflow.com/questions/35869054/using-jeditable-and-getting-typeerror-editable-is-not-a-function-what-t -->
<script src="http://www.appelsiini.net/download/jquery.jeditable.mini.js"></script>

<!-- third party js -->
<script src="static/libs/datatables/jquery.dataTables.min.js"></script>
<script src="static/libs/datatables/dataTables.bootstrap4.js"></script>
<script src="static/libs/datatables/dataTables.responsive.min.js"></script>
<script src="static/libs/datatables/responsive.bootstrap4.min.js"></script>
<script src="static/libs/datatables/dataTables.buttons.min.js"></script>
<script src="static/libs/datatables/buttons.bootstrap4.min.js"></script>
<script src="static/libs/datatables/buttons.html5.min.js"></script>
<script src="static/libs/datatables/dataTables.keyTable.min.js"></script>
<script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>

<!-- third party js ends -->
<script src="static/libs/select2/select2.min.js"></script>

<script src="static/js/pages/form-advanced.init.js"></script>

<!-- Datatables init -->
<script src="static/js/pages/datatables.init.js"></script>

<!-- App js -->
<script src="static/js/app.min.js"></script>

<!-- flatpicker js -->
<script src="static/libs/flatpickr/flatpickr.min.js"></script>

<!-- Sweetalert -->
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<!-- upper dropdown datepicker js -->
<script src="static/libs/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>

<script src="static/libs/jquery-ui/jquery-ui.min.js"></script>

<!--<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" type="text/javascript"></script>-->
{% endblock js %}
{% block body %}
<div id="snackbar">Some text some message..</div>
<!-- ============================================================== -->
<!-- Start Page Content here -->
<!-- ============================================================== -->
<div class="content-page">
    <div class="content">
        <!-- Start Content-->
        <div class="container-fluid">
            <!-- start page title -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box">
                        <h4 class="page-title">Buying Manager</h4>
                        <div id="con-close-modal" class="modal fade "  tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title">Add Buy</h4>
                                        <button aria-hidden="true" class="close" data-dismiss="modal"
                                                onclick="closemodal()"
                                                type="button">×
                                        </button>
                                    </div>

                                    <form action="/buyingmanager" id="buyingManagerForm" method="post" >
                                        <div class="modal-body p-4" id="loaderMain">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <label class="control-label" for="Retailers">Retailers</label>
                                                        <select class="form-control" id="Retailers" name="Retailers"
                                                                required>
                                                            <option disabled hidden selected value="">Select Retailers
                                                            </option>
                                                            <option value="Amazon">Amazon</option>
                                                            <option value="Bass">Bass</option>
                                                            <option value="DSG">DSG</option>
                                                            <option value="Home Depot">Home Depot</option>
                                                            <!--<option value="Hp.com">Hp.com</option>-->
                                                            <option value="Kohls">Kohls</option>
                                                            <option value="Lowes">Lowes</option>
                                                            <option value="Sams Club">Sams Club</option>
                                                            <option value="Sears">Sears</option>
                                                            <option value="Walmart">Walmart</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <div id="buying-items">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="control-label" for="Sku-1">Item Sku </label>
                                                            <input class="form-control space_not_allow" id="Sku-1" name="Sku-1"
                                                                   placeholder="3452"
                                                                   required type="text" pattern="\S+" title="This field is required">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="control-label" for="Price-1">Price </label>
                                                            <input class="form-control" id="Price-1" name="Price-1"
                                                                   onkeyup="total(id)" placeholder=" $29 " required
                                                                   type="number" min="0" step="any">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="control-label" for="QtyPerCart-1">Qty Per
                                                                Cart</label>
                                                            <input class="form-control" id="QtyPerCart-1"
                                                                   name="QtyPerCart-1"
                                                                   onkeyup="total(id)" placeholder="1"
                                                                   required type="number" step="number" min="0">
                                                        </div>
                                                    </div>

                                                    <div class="col-md-3">
                                                        <div class="form-group">
                                                            <label class="control-label" for="TotalQty-1">Total Qty</label>
                                                            <input class="form-control" id="TotalQty-1"
                                                                   name="TotalQty-1"
                                                                   onkeyup="total(id)" placeholder="10" required
                                                                   type="number" min="0" step="number">
                                                        </div>
                                                    </div>
                                                </div>
                                                <h5><span id="Warring-1" style="color:red"></span></h5>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label class="control-label" for="switch11">Shipping</label>
                                                        <div class="form-group">
                                                            <label class="switch" id="switch11">
                                                                <input name="Shipping" type="checkbox" value="1">
                                                                <span class="slider round"></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label class="control-label" for="switch12">Tax</label>
                                                        <div class=" form-group">
                                                            <label class="switch" id="switch12">
                                                                <input name="Tax" type="checkbox" value="1">
                                                                <span class="slider round"></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label class="control-label" for="TotalCart">Subtotal</label>
                                                        <input class="form-control" id="TotalCart" name="TotalCart"
                                                               onkeyup="subtotaltototal(event)" placeholder="$100 " type="number" min="0" step="any" required>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label class="control-label" for="PaymentType">Payment Type</label>
                                                        <select class=" form-control" id="PaymentType"
                                                                name="PaymentType" required>
                                                            <option>Credit Card</option>
                                                            <option>Gift Cards</option>
                                                            <option>Maximize Gift Card</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label class="control-label" for="userDataList">Assign Users</label>
                                                    <select class="form-control select2-multiple"
                                                            data-placeholder="Choose ..."
                                                            data-toggle="select2" id="userDataList"
                                                            multiple="multiple" name="userDataList"
                                                            onchange="dataList()" required>
                                                        <optgroup>
                                                            <option class='allValue' value="All">All</option>
                                                            {% if userData|length == 1 %}
                                                            <option class='userData' value="{{userData[0].userid}}" selected="selected">
                                                                {{ userData[0].contactName|trim }}
                                                            </option>
                                                            {% else %}
                                                            {% for x in userData %}
                                                            <option class='userData' value="{{x.userid}}">
                                                                {{x.contactName|trim}}
                                                            </option>
                                                            {% endfor %}
                                                            {% endif %}
                                                        </optgroup>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group mt-1">
                                                        <label class="control-label" for="field-9"></label>
                                                        <select class=" form-control" id="field-9" name="shipping_set" required>
                                                            <option value="ShipToHome">Ship To Home</option>
                                                            <option value="ShipToStore">Ship To Store</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group mt-1">
                                                        <label class="control-label" for="field-10"></label>
                                                        <select class=" form-control" id="field-10" name="loginId_Set" required>
                                                            <option value="Login">Login</option>
                                                            <option value="GuestCheckout">Guest Checkout</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label class="control-label" for="vendor">Affiliate</label>
                                                    <select class="form-control" id="vendor" name="vendor" required>
                                                        <option disabled hidden selected value="">Select Affiliate
                                                        </option>
                                                        <option value="MrRebates">Mr Rebates</option>
                                                        <option value="BeFrugal">BeFrugal</option>
                                                        <option value="iConsumer">iConsumer</option>
                                                        <option value="Rakuten">Rakuten</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <h5><span id="Warring-3" style="color:red"></span></h5>
                                            <h5><span id="display_total_add"></span></h5>
                                        </div>
                                        <!--                                          <div style="display:none;" id="updateMsg"><h5 style="color:#1abc9c;">Successfully Record inserted</h5></div>-->
                                        <div class="modal-footer">
                                            <button class="btn btn-info waves-effect waves-light" id="add_field_button"
                                                    type="button"
                                                    type="button">Add Item
                                            </button>
                                            <button id="before_submit" class="btn btn-info waves-effect waves-light">Submit</button>
                                        </div>
                                        <input id="noRow" name="noRow" type="hidden" value="1">
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="float-right modal-cusm">
                            <button class="btn btn-success waves-effect waves-light" data-target="#con-close-modal"
                                    data-toggle="modal"
                                    type="button" onclick="dataList()">Add Buy
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- end page title -->
            <!--  Start Edit Cart     -->
            <div id="con-close-modal-1" class="modal fade " tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
							<div class="modal-dialog modal-lg">
								<div class="modal-content">
									<div class="modal-header">
										<h4 class="modal-title">Edit Buy</h4>
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
									</div>

									<form id="edit_buyingmanager" action="/buyingUpdateData" method="POST">
                                        <div class="modal-body p-4" id="updateMain">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <label for="updateRetailers" class="control-label">Retailers</label>
                                                        <input type="text" class="form-control" value="" id="updateRetailers" readonly placeholder=" Target " required> </div>
                                                    </div>
                                            </div>

                                            <div class='count listData' id="update-buying-items">

                                            </div>
                                            <h5><span style="color: red" id='error'></span></h5>

                                            <div class="row">
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label for="updateTotalCart" class="control-label">Subtotal</label>
                                                        <input required type="number" min="0" step="any" onkeyup="updatesubtotaltototal(event)" class="form-control" name="TotalCart" value="" id="updateTotalCart" placeholder="$100 "> </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label for="updatePaymentType" class="control-label">Payment Type</label>
                                                        <select class=" form-control" name="PaymentType" id="updatePaymentType" required>
                                                            <option>Credit Card</option>
                                                            <option>Gift Cards</option>
                                                            <option>Maximize Gift Card</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group mt-1">
                                                        <label for="updateShip" class="control-label"></label>
                                                        <select name="shipping_set" class=" form-control" id="updateShip" required>
                                                          <option value="ShipToHome">Ship To Home</option>
                                                          <option value="ShipToStore">Ship To Store</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group mt-1">
                                                        <label for="updateLog" class="control-label"></label>
                                                        <select name="loginId_Set" class="form-control" id="updateLog" required>
                                                            <option value="Login">Login</option>
                                                            <option value="GuestCheckout">Guest Checkout</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label for="updateUserDataList" class="control-label">Assign Users</label>
                                                    <select required name="userDataList" class="form-control select2-multiple" onchange="dataListUpdate()" id="updateUserDataList" data-toggle="select2" multiple="multiple" data-placeholder="Choose ...">
                                                                <option class='allValue' value="All">All</option>
                                                                {% for x in userData %}
                                                                <option class='userData' value="{{x.userid}}">
                                                                    {{x.contactName|trim}}
                                                                </option>
                                                                {% endfor %}
                                                            </optgroup>
                                                     </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="updatevendor" class="control-label">Affiliate</label>
                                                    <select required class="form-control" name="vendor" id="updatevendor">
                                                        <option disabled hidden selected value="">Select Affiliate
                                                        </option>
                                                        <option value="MrRebates">Mr Rebates</option>
                                                            <option value="BeFrugal">BeFrugal</option>
                                                            <option value="iConsumer">iConsumer</option>
                                                            <option value="Rakuten">Rakuten</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <h5><span id="display_total"></span></h5>
                                            <input type="hidden" id="update_display_total" value="0">
                                            <input type="hidden" id="updateId" readonly>
                                        </div>
                                        <div class="modal-footer">
                                            <button id='save' type="submit" class="btn btn-info waves-effect waves-light">Save</button>
                                        </div>
                                        <input id="noRowUpdate" name="noRow" type="hidden" value="1">
                                    </form>
								</div>
							</div>
						</div>
            <!--        End Edit Cart        -->

            <div aria-hidden="true" aria-labelledby="myModalLabel" class="modal fade mt-5" id="modal-date-custom"
                 role="dialog" style="display: none;" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">

                        <div class="modal-header">

                            <h4 class="modal-title">Select Date Range</h4>
                            <button aria-hidden="true" class="close" data-dismiss="modal" onclick="closemodal()"
                                    type="button">×
                            </button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="form-group mb-0">
                                <div class="input-group">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>From:</label>
                                                <input class="form-control" id="dp-from" type="text">
                                            </div>
                                            <div class="col-md-6">
                                                <label>To:</label>
                                                <input class="form-control" id="dp-to" type="text">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-info waves-effect waves-light" id="dateButton"
                                    onclick="customDate()"
                                    type="button">Submit
                            </button>
                            <button class="btn btn-secondary waves-effect" data-dismiss="modal" onclick="closemodal()"
                                    type="button">Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.modal -->

            <div class="row">
                <div class="col-sm-12">
                    <div class="card-box">
                        <div class="alert alert-info d-none {% if success %} d-block {% endif %} fade show">
                            <h4>Successfully</h4>
                            <p class="mb-0">Record inserted</p>
                        </div>
                        <div class="row mb-2">
                        <div class="form-group mr-2">
                                 <button type="button" id="selectall" onclick='selectAll(id)'  class="btn btn-secondary waves-effect waves-light btn-block ">Select All</button>
                              </div>
                              <div class="form-group mr-2">
                                 <button type="button" id="Delete" onclick='deleteTableRows(id)'  class="btn btn-danger waves-effect waves-light btn-block ">Delete</button>
                              </div>

                            <div class="form-group mr-2 btn-group boxline1">
                                <button aria-expanded="false" aria-haspopup="true"
                                        class="btn btn-group btn-info dropdown-toggle" data-toggle="dropdown"
                                        type="button">Bulk Action <i
                                        class="mdi mdi-chevron-down"></i></button>
                                    <div class="dropdown-menu">
                                        <a href="javascript:void(0);" class="dropdown-item" id="Priority" onclick="changedata(this.id)">Priority</a>
                                        <a href="javascript:void(0);" class="dropdown-item" id="Active" onclick="changedata(this.id)">Active </a>
                                        <a href="javascript:void(0);" class="dropdown-item" id="Inactive" onclick="changedata(this.id)">Inactive </a>
                                        <a href="javascript:void(0);" class="dropdown-item" id="Paused" onclick="changedata(this.id)">Paused </a>
                                        <a href="javascript:void(0);" class="dropdown-item" id="Cancelled" onclick="changedata(this.id)">Cancelled </a>
<!--                                        <a href="javascript();" class="dropdown-item" id="DeleteStatus" onclick="changedata(this.id)">Delete Status</a>-->
                                    </div>
                            </div>
                            <!-- /btn-group -->
                            <div class="form-group mr-2">
                                <select class="selectpicker scrollable-menu" data-size="7" id="timefilter" onchange="dateFilter(this)">
                                   <option value="DateRange">Date Range</option>
                                   <option value="Last7days">Last 7 days</option>
                                   <option value="ThisWeek">This Week</option>
                                   <option value="Last30days">Last 30 days</option>
                                   <option value="LastMonth">Last Month</option>
                                   <option value="ThisMonth">This Month</option>
                                   <option value="Custom">Custom</option>
                                </select>
                             </div>

                            <div class="form-group mr-2">
                                <select class="selectpicker scrollable-menu" data-size="7" id="statusFilter" onchange="statusFilter(this)">
                                    <option value="Status">Status</option>
                                    <option value="All">All</option>
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                    <option value="Paused">Paused</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div class="form-group mr-2">
                                <select class="selectpicker" data-size="7" id="retailersFilter"
                                        onchange="retailerFilter(this)">
                                    <option>Retailers</option>
                                    {% for ret in distinct_retailer %}
                                        <option value="{{ret.0}}">{{ret.0}}</option>
                                    {% endfor %}
                                    <!-- <option value="Cabela''s">Cabela’s</option> -->
                                </select>
                            </div>
                            <div class="form-group mr-2">
                                <select class="selectpicker" data-size="7" id="retailersFilter" onchange="assignedto(this)">
                                    <option>Assigned To</option>
                                    {% for x in userData %}
                                    <option class='userData' value="{{x.userid}}">
                                        {{x.contactName|title}}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <!----- Create new7 buying manager layout table --->
                        <div class=" row">
                              <div class="col-12" style='overflow-x: auto'>
                                <div class="table-responsive">
                                <!--<div class="col-md-12">-->
                                    <table id="ptbldemo" class=" table w-100 table-bordered nowrap table-hover">
	                                    <span id="showcustomdate"></span>
                                        <span id="showselectedbox"></span>
                                        <thead class="thead-light">
	                                        <tr>
	                                            <th class="no-sort"><input type="checkbox" name="check1" id="cb-bulk" class="cb-tab"></th>
	                                            <th>Priority</th>
                                                <th>Date</th>
	                                            <th>Retailer</th>
	                                            <th>Skus</th>
	                                            <th>Tax</th>
	                                            <th>Shipping</th>
	                                            <th>Sub Total</th>
	                                            <th>Orders</th>
	                                            <th>Completed</th>
	                                            <th>Cancelled </th>
	                                            <th>Status</th>
	                                            <th></th>
	                                        </tr>
	                                    </thead>
	                                </table>
                                </div>
                              </div>
                        </div>
                        <!------------------------------------------------>
                    </div>
                    <!-- end card-box -->
                </div>
                <!-- end col -->
            </div>
        </div>

        <!-- container -->
    </div>
    <div class="rightbar-overlay"></div>
    <!-- content -->
    <!-- Vendor js -->
    <script src="static/js/vendor.min.js"></script>
    <script>
        var url = window.location.href;
        setTimeout(function(){
            if (url.indexOf('?') > -1){
                window.location = url.split("?")[0];
            }
          },3000)
    </script>
    <script>
        function showTableLoader(){
          $(".dataTables_processing").show(0);
          return true;
       }
       function hideTableLoader(){
         $(".dataTables_processing").hide(0);
         return false;
       }
     </script>
     <script>
        $(function(){
          $('.space_not_allow').bind('input', function(){
            $(this).val(function(_, v){
             return v.replace(/\s+/g, '');
            });
          });
        });
    </script>
    <!------- toast functionality  ------->
    <script type="text/javascript">
        function showSnackbar(text) {
            var x = document.getElementById("snackbar");
            x.innerHTML = text;
            x.className = "show";
            setTimeout(function(){ x.className = x.className.replace("show", ''); }, 3000);
        }
    </script>
    <!------- toast functionality close  ------->
    <!--------  This script create for new table layout for buying manager  ----------->
    <script>
        function newtablecreate(rowId, iconId, element) {
            $('.expandableTable').remove();
            if(rowId !== undefined){
            var id_data = rowId.replace("td-", "");
            var current_element = $(element).find(iconId)
            if (current_element.hasClass('fa-angle-down')) {
                current_element.removeClass('fa-angle-down').addClass('fa-angle-up');
                let expandableTableElement = `<tr class="expandableTable" style="background-color: #f1f5f7;border-color: #dee2e6;">
                <th>#</th>
                <th colspan="2">Sku</th><th colspan="2">Price</th>
                <th colspan="2">Qty Per Cart</th><th colspan="2">Total Qty</th>
                <th colspan="2">Ordered</th><th colspan="2">Total Cost</th></tr>`
                $.ajax({
                  type: "POST",
                  url: '/detailbuyingmanger?id='+id_data,
                  success: function(result) {
						//console.log(result)
						var detail_data = result.data
						$.each(detail_data, function(key, item){
                         expandableTableElement += `<tr class="expandableTable"><th><input type="checkbox" name="check[]" value="` + item.id + `"  data-type="child" class="cb-single"></th>
                          <td colspan="2" style="white-space: break-spaces;">`+item.Item_Sku+`</td><td colspan="2">$`+item.Price+`</td><td colspan="2">`+item.Qty_Per_Cart+`</td><td colspan="2">`+item.Total_Qty+`</td><td colspan="2">`+item.Fulfilled+`</td><td colspan="2">$`+item.Total_Cost+`</td></tr>`
                        });

                        $(element).parent().parent().after(expandableTableElement);
				  },
                  dataType: 'json',
                  contentType: "application/json",
                });

            } else {
                   $('.fa-angle-up').removeClass('fa-angle-up').addClass('fa-angle-down');
                }
                }
        }
        $('#ptbldemo').on("click",".addtable",function(event){
            event.stopPropagation();
            event.stopImmediatePropagation();
            $('.expandableTable').remove();
            var tablerow = $(this);

            //console.log(tablerow)
            var last_element = tablerow.siblings(':last').children(':last');
            let id_data = last_element.attr('id');
            newtablecreate(id_data, '#up-arrow-icon', last_element)
        });
    </script>
    <!------- close model form  ------->
    <script type="text/javascript">
 	    function closemodal(){
                 // get modals
                 const modals = document.getElementsByClassName('modal');
                 // on every modal change state like in hidden modal
                 for(let i=0; i<modals.length; i++) {
                 	modals[i].classList.remove('show');
                 	modals[i].setAttribute('aria-hidden', 'true');
                 	modals[i].setAttribute('style', 'display: none');
                 	//location.reload();
                 }
             }
    </script>
    <!------- close model form closed ------->
    <!-- checkbox functionality ------------>
    <!-- checkbox functionality ------------>
 <script type="text/javascript">
   unSelectArr = [];
   $(document).on("click", "#cb-bulk", function(){
      //when selectall button is used with uppermost checkbox
      if(selectall == "allrecords"){
               var checkboxes = document.getElementsByName("check[]");
               // loop over them all
               for (var i=0; i<checkboxes.length; i++) {
                        // And stick the checked ones onto an array...
                  if (checkboxes[i].checked) {
                     unSelectArr.push(checkboxes[i].value);
                  }
               }
                  $(".cb-single").prop("checked", $(this).prop("checked"));
                  if($(this).prop("checked")) {
                     unSelectArr = []
                     var total_checked =  "You’ve Selected "+ (total_records_count + unSelectArr.length) + " Items"
                     document.getElementById("showselectedbox").innerHTML = total_checked;
                     document.getElementById("showselectedbox").style.display= 'inline';
                  }
               else{
                  var total_checked =  "You’ve Selected "+ (total_records_count - unSelectArr.length) + " Items"
                  document.getElementById("showselectedbox").innerHTML = total_checked;
                  document.getElementById("showselectedbox").style.display= 'inline';
                  if((total_records_count - unSelectArr.length) === 0){
                     removechecked();
                  }
               }
      //when uppermostcheckbox button is clicked without selectall
      }else{
          $(".cb-single").prop("checked", $(this).prop("checked"));
         if($(this).prop("checked")) {
            let total_checked =  "You’ve Selected "+ $(".cb-single").length + " Items"
            document.getElementById("showselectedbox").innerHTML = total_checked;
            document.getElementById("showselectedbox").style.display= 'inline';
         } else  {
            document.getElementById("showselectedbox").style.display= 'none';

         }
      }
   });

   $(document).on("click", ".cb-single", function(){
      var all = $(".cb-single").length;

      // get index of given id from an array
      const index = unSelectArr.indexOf(event.target.value);
      // add in unSelectArr only when event.target.checked is false
      if (!event.target.checked) {
         // index is -1 means the vslue not exists in array
         if (index == -1) {
            unSelectArr.push(event.target.value);
         }
      } else {
         // remove from unSelectArr if checked
         // remove that index from an array using splice function
         unSelectArr.splice(index, 1);
      }
      console.log('unSelectArr', unSelectArr);

      var checked = $(".cb-single:checked").length;
      //this works for selecting each check-box
      if(unSelectArr.length > 0 && selectall == "allrecords"){
         var total_checked =  "You’ve Selected "+ (total_selected_record - unSelectArr.length) + " Items"
      }else if(selectall == "allrecords"){
         var total_checked =  "You’ve Selected "+ (total_selected_record - unSelectArr.length) + " Items"
      }
      else{
         var total_checked =  "You’ve Selected "+ checked + " Items"
      }

      document.getElementById("showselectedbox").innerHTML = total_checked;
      document.getElementById("showselectedbox").style.display= 'inline';

      if(all == checked){
         $(".cb-tab").prop("checked", true);
      }else{
         $(".cb-tab").prop("checked", false);
         // if select checkbox become zero then it will hide
         if (checked == 0){
            document.getElementById("showselectedbox").style.display= 'none';
            removechecked();
         }
      }
   });
</script>
<script>
   function removechecked(){
        $(".cb-single").prop("checked", false);
        $(".cb-tab").prop("checked", false);
        this.selectall_data = '';
        if(selectall != ""){
            if(buyingManagerTable.$('tr').hasClass('selected')) {
                 this.selectall_data = '';
                 selectall = "";
                 unSelectArr = []
                 total_records_count = 0
                 $('#selectall').text("Select All");
                 buyingManagerTable.rows().deselect();
                 document.getElementById("showselectedbox").style.display= 'none';
              }
       }
   }
   function calculateChecked(){
    if(selectall == "allrecords"){
          var total_checked =  "You’ve Selected "+ (total_selected_record) + " Items"
          document.getElementById("showselectedbox").innerHTML = total_checked;
          document.getElementById("showselectedbox").style.display= 'inline';
          if(total_selected_record === 0){
            removechecked()
          }
      }
   }
</script>
    <!-- Hide upper and down arrow from first column in datatable -->
    <script type="text/javascript">
        $(document).ready(function(){
            function checkfirstcolumn(){
                if($(".no-sort").hasClass("sorting_asc")){
                    $(".no-sort").removeClass("sorting_asc");
                }
                setTimeout(function(){
                checkfirstcolumn();
                },1000)}
           checkfirstcolumn();
        });
    </script>
    <!----- upper dropdown custom date picker functionality -------->
    <script type="text/javascript">
       $(function(){
           $("#dp-from").datepicker({
              dateFormat: "mm-dd-yy",
               "endDate": "today",
                maxDate: 0,
                onSelect: function(selected) {
                  $("#dp-to").datepicker("option","minDate", selected)
                }
           });
             $("#dp-to").datepicker({
                dateFormat: "mm-dd-yy",
                "endDate": "today",
                maxDate: 0
           });
       });

        $('#dp-from').keydown(function(e) {
           e.preventDefault();
           return false;
        });
        $('#dp-to').keydown(function(e) {
           e.preventDefault();
           return false;
        });
       $(function () {
          $('[data-toggle="tooltip"]').tooltip('toggle')
        })
    </script>
    <!----- upper dropdown custom date picker functionality closed -------->
    <script>
        function close_sku_item(id,element){
            let sku_item_len = $("#buying-items > div.row").length;
            document.getElementById("noRow").value=sku_item_len-1;
            $(element).parent().remove();
            showSnackbar("Removed.");
            //so it dynamic change the id number & its name
            if(sku_item_len > id){
              for(i=sku_item_len; i<= sku_item_len; i--) {
                 if( i > id){
                       document.getElementById('Sku-'+i).name       = 'sku_'+ (i-1);
                       document.getElementById('Sku-'+i).parentElement.parentElement.parentElement.firstChild.id = i-1;
                       document.getElementById('Sku-'+i).id         = 'Sku-'+ (i-1);
                       document.getElementById('Price-'+i).name  = 'price-'+ (i-1);
                       document.getElementById('Price-'+i).id    = 'Price-'+ (i-1);
                       document.getElementById('QtyPerCart-'+i).name  = 'qtypercart-'+ (i-1);
                       document.getElementById('QtyPerCart-'+i).id    = 'QtyPerCart-'+ (i-1);
                       document.getElementById('TotalQty-'+i).name  = 'totalunit-'+ (i-1);
                       document.getElementById('TotalQty-'+i).id    = 'TotalQty-'+ (i-1);
                       document.getElementById('Warring-'+i).id    = 'Warring-'+ (i-1);
                 }else{
                    break;
                 }
              }
            }
            total(id);
        }
    </script>
    <!----- Add more filed in add button -------->
    <script type="text/javascript">
        // Add more filed in add button
        $(document).ready(function() {
            var wrapper   	  = $("#buying-items"); //Fields wrapper
            var add_button    = $("#add_field_button"); //Add button ID
            var x = 1; //initlal text box count
            $(add_button).click(function(e){ //on add input button click
                e.preventDefault();
                x++; //text box increment
                var item_len = $("#buying-items > div.row").length + 1;
                if (x>item_len){
                    x = item_len
                }
                document.getElementById("noRow").value=x
                  $(wrapper).append('<div class="row">'+
                    "<button type='button' class='close close_button' id='"+x+"' onclick='close_sku_item(id,this);'>×</button>"+
                     '<div class="col-md-3">'+
                       '<div class="form-group">'+
                          '<label for="field-2" class="control-label">Item Sku </label>'+
                          '<input required type="text" class="form-control space_not_allow"  name="Sku-'+x+'" id="Sku-'+x+'" placeholder="3452">'+
                       '</div>'+
                     '</div>'+
                     '<div class="col-md-3">'+
                        '<div class="form-group">'+
                           '<label for="field-3" class="control-label">Price </label>'+
                           '<input required type="number" min="0" step="any" class="form-control" name="Price-'+x+'" id="Price-'+x+'" onkeyup="total(id)" placeholder=" $29 ">'+
                        '</div>'+
                     '</div>'+
                     '<div class="col-md-3">'+
                        '<div class="form-group">'+
                           '<label for="field-4" class="control-label">Qty Per Cart</label>'+
                           '<input required type="number" min="0" step="number" class="form-control" name="QtyPerCart-'+x+'" id="QtyPerCart-'+x+'" onkeyup="total(id)" placeholder="1">'+
                        '</div>'+
                     '</div>'+
                     '<div class="col-md-3">'+
                        '<div class="form-group">'+
                           '<label for="field-5" class="control-label">Total Qty</label>'+
                           '<input required type="number" min="0" step="number" class="form-control" name="TotalQty-'+x+'" id="TotalQty-'+x+'" onkeyup="total(id)" placeholder="10">'+
                        '</div>'+
                     '</div>'+
                    '<h5><span style="color:red" id="Warring-'+x+'"></span></h5>'+
                 '</div>');
                 showSnackbar("Added");
              });
          });
    </script>
    <!----- Add more filed in add button closed -------->
    <script>
        function  getStatusSelectFilter(data, row) {
           let htmlString   =  '<select id="' + row.Edit + '"  onchange="changeStatus(this.id)" class="hd3">' +
           '<option value="' + row.Status + '" checked >' + row.Status + '</option>'
            if (row.Status != 'Active') {
                htmlString += '<option value="Active" >Active  </option>'
            }
            if (row.Status != 'Inactive') {
                htmlString += '<option value="Inactive">Inactive</option>'
            }
            if (row.Status != 'Paused') {
                htmlString += '<option value="Paused">Paused</option>'
            }
            if (row.Status != 'Cancelled') {
                htmlString += '<option value="Cancelled">Cancelled</option>'
            }
         htmlString = htmlString + '</select>';
         return htmlString
      }
    </script>

    <!----- Operation perform for display data table and updation -------->
    <script type="text/javascript">
      //function for flat datepicker
      function initDP() {
           var today = new Date();
           $(".p-datepicker").flatpickr({
              dateFormat:"m-d-Y",
              disableMobile: true,
              maxDate: today
           });
      }

      //---------------function for updating the status --------------//
      function changeStatus(selectedObject) {
         selectedStatus=document.getElementById(selectedObject).value

         //console.log(selectedObject)
         //console.log(selectedStatus)

         const updateValue = {"cellName":"status", "id":selectedObject, "newValue":selectedStatus};
         // call API here to update date in database
         $.ajax({
                type: 'POST',
                url: '/allOrderStatusChange',
                data: updateValue,
                success: function(response) {
                    //console.log(response);
                    showSnackbar(response.message);
                    buyingManagerTable.draw();
                },
                error: function(error) {
                    console.log(error);
                }
          });
      }

      function statusFunction(idData) {
            id = String(idData).slice(2)
            $.ajax({
                type: 'POST',
                url: '/buyingstatusChange/' + id,
                data: {
                    status: $('input#' + idData).prop('checked'),
                    change: idData
                },
                success: function(response) {
                    var data = JSON.parse(response)
                    updateMsg = data.message
                    showSnackbar(updateMsg + ' updated.');
                }
            });
      }

      var buyingManagerTable = undefined;
      $(document).ready(function() {
          document.getElementById("noRow").value = "1"
          document.getElementById("noRowUpdate").value = "0"

         //this code work when you refresh the page
         if (performance.navigation.type != 2){
         //checks if page is accessed through a link or refresh
             buyingManagerTable = $('#ptbldemo').DataTable();
             buyingManagerTable.state.clear();
             buyingManagerTable.destroy(); // need to destroy the table, I don't know why..
          }
          // table initialization code
          buyingManagerTable = $('#ptbldemo').DataTable({
               serverSide: true,
               processing: true,
               'language': {
                    'loadingRecords': '&nbsp;',
                    'processing': '<div class="spinner"></div>'
               },
               searching: true,
               "aoColumnDefs": [
                    { "bSortable": false, "aTargets": [ 0, 5, 6, 12 ] },
                    { "bSearchable": true, "aTargets": [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11 ] },
                    { "className":"addtable", "targets":[2,3,4,7,8,9,10] }
               ],
               columns: [{
                        data: "",
                        "orderable":false,
                        "render": function(data, type, row, meta) {
                            return '<input type="checkbox" name="check[]" value="' + row.id + '" data-type="parent" class="cb-single">'
                        }
                    },{
                        "data": "",
                        "render": function(data, type, row, meta) {
                            //let row_num =  meta.row + meta.settings._iDisplayStart + 1;
                            let row_num =  meta.row
                            let priority_num = row.Priority
                            return "<button id='"+row_num+"' onclick='moveDown(id,this)' data-toggle='tooltip' data-placement='left' title='"+priority_num+"' class='row-font-downarrow button-arrow'><i class='fa fa-arrow-down' aria-hidden='true'></i></button> <button class='round-button'> <span>"+priority_num+"</span> </button> <button id='"+row_num+"' onclick='moveUp(id,this)' data-toggle='tooltip' data-placement='right' title='"+priority_num+"' class='row-font-downarrow button-arrow'><i class='fa fa-arrow-up' aria-hidden='true'></i></button>"
                        }
                    },
                    {
                        "data": "Start_Date"
                    },{
                        "data": "Retailer"
                    },{
                        "data": "Skus"
                    },{
                        "data": "Tax",
                        "render": function(data, type, row, meta) {
                            if (row.Tax == 1) {
                                return '<label class="switch"><input checked  type="checkbox" id="tx' + row.id + '" onchange="statusFunction(id)"><span class="slider round"></span></label>'
                            } else {
                                return '<label class="switch"><input  type="checkbox" id="tx' + row.id + '" onchange="statusFunction(id)"><span class="slider round"></span></label>'
                            }
                        }
                    },{
                        "data": "Shipping",
                        "render": function(data, type, row, meta) {
                            if (row.Shipping == 1) {
                                return '<label class="switch"><input checked  type="checkbox" id="sp' + row.id + '" onchange="statusFunction(id)"><span class="slider round"></span></label>'
                            } else {
                                return '<label class="switch"><input  type="checkbox" id="sp' + row.id + '" onchange="statusFunction(id)"><span class="slider round"></span></label>'
                            }
                        }
                    },{
                        "data": "Subtotal",
                        "render": function(data, type, row, meta) {
                                return '<span>$'+String(data)+'</span>'
                            }
                    },{

                        "data": "Orders"
                    },{
                        "data": "Completed"
                    },{
                        "data": "Cancelled"
                    },{
                        "data": "Status",
                        "render": function( data, type, row, meta ) {
                              return getStatusSelectFilter(data, row);
                           }
                    },{
                        "data": "Edit",
                        "render": function(data, type, row, meta) {
                            return "<span onclick='edit_cart(this)' class='row-font-icon11' data-id = \""+row.id+"\" data-target='#con-close-modal-1' data-toggle='modal'><i class='icon-pencil' style='color:blue;'></i></span><span id = \"d-"+row.id+"\" onclick='deleteRow(id,this)' class='row-font-icon11'><i class='fe-trash-2' style='color:red;'></i></span><span class='row-font-downarrow' id = \"td-"+row.id+"\" onclick='newtablecreate(id,\"#up-arrow-icon\",this)'><i id='up-arrow-icon' class='fa fa-angle-down' aria-hidden='true'></i></span>"
                     }
                  }
               ],
               "ajax": {
               'type': 'post',
               'url': '/buyingdatatable',
               'dataType': 'json',
               "contentType": "application/json",
               error: function (jqXHR, textStatus, errorThrown) {
                console.log(textStatus, "Server Busy, Loading data, Please try again...")
               },
               "data": function ( d ) {
                           //console.log(d)
                           showTableLoader();
                           d.assigneduser = this.assigneduser
                           d.move_data = this.move_data
                           return JSON.stringify(d)
                     }
               },
               "drawCallback": function( settings ) {
                   hideTableLoader();
                   if(selectall == "allrecords") {
                      selectAllShow()
                   }
               }
            })
      $('.selectpicker').selectpicker();
      });

    </script>
    <!----- Operation perform for display data table and updation closed -------->
    <script>
       // Move the row up
        function moveUp(id,element) {
            //var tr = $(this).parents('tr');

            //$(element).siblings().removeClass('active');
            //$(element).addClass('active');
            var index = id;
            moveRow(index, 'up', element);
        }

        // Move the row down
        function moveDown(id,element) {
            //var tr = $(this).parents('tr');
            //$(element).siblings().removeClass('active');

            var index = id;
            moveRow(index, 'down', element);
        }

        // Move up or down (depending...)
        var move_data = {};
        function moveRow(row, direction,element) {
            this.move_data = {};
            var index = buyingManagerTable.row(row).index();
            $(element).addClass('active');
            var order = -1;
            if (direction === 'down') {
              order = 1;
            }else if(index=== 0){
                showSnackbar("Not allowed.");
                setTimeout(function(){
                showSnackbar("Please show more entries.");
                },3000);
                return;
            }
            var data1 = buyingManagerTable.row(index).data();
            data1.order += order;

            try{
                var data2 = buyingManagerTable.row(index + order).data();
                data2.order += -order;
            }catch(err) {
                showSnackbar("Not allowed.");
                setTimeout(function(){
                showSnackbar("Please show more entries.");
                },3000);
              return;
            }
            this.move_data = {
                "type":"priority",
                "direction":direction,
                "index":index,
                "row_data1":data1,
                "row_data2":data2
            }

            buyingManagerTable.row(index).data(data2);
            buyingManagerTable.row(index + order).data(data1);
            buyingManagerTable.draw(false);
            setTimeout(function(){
                this.move_data = {};
                },5000);
        }
    </script>
    <!-- select and chnage multiple status in one time -->
    <script type="text/javascript">
        function changedata(status){
            if(this.selectall != ""){
                data = {"records":"total_record", "get_ids":true, "statusOperation":status, "statusValue":this.status, "selectall":this.selectall, "retailerValue":this.retailer, "dateValue":this.dateValue, "assigneduser":this.assigneduser, "searchValue": getSeachValue(), 'unSelectArr':unSelectArr}
                if ((data.statusValue != "" && data.statusValue != "Status") || (data.dateValue != "" && data.dateValue != "DateRange") || data.selectall != "" || (data.retailerValue != "" && data.retailerValue != 'Retailers') || (data.assigneduser != "" && data.assigneduser != "Assigned To")) {
                     $.ajax({
                         type: "POST",
                         //call the url with data
                         url: "/selectalloperationbmforcount",
                         data: JSON.stringify(data),
                         success: function(d) {
                            console.log('success', d);
                            showSnackbar('Please wait...')
                            d['selectall']= data['selectall']
                            d['statusOperation']= data['statusOperation']
                            //get all the id in response & send back to the giftcardcheckbalance url
                            $.ajax({
                                  type: "post",
                                  url: "/buyingbulkaction",
                                  data: JSON.stringify(d),
                                  dataType: 'json',
                                  contentType: "application/json",
                                  success:function(msg) {
                                     removechecked();
                                     showSnackbar(msg['message'])
                                     console.log(msg)
                                     buyingManagerTable.draw();
                                     setTimeout(function(){
                                        document.getElementById("showselectedbox").style.display= 'none';
                                        if(msg['code'] === 201){
                                           location.reload();
                                        }
                                     },2000)
                                  },
                            });
                      },
                      dataType: 'json',
                      contentType: "application/json"
                   });
               }
            }else{
                var checkboxes = document.getElementsByName("check[]");
                var checkboxesChecked = [];
                var checkboxesType = [];
                var checkedRows={}
                checkedRows['status'] = status;
                // loop over them all
                for (var i=0; i<checkboxes.length; i++) {
                 // And stick the checked ones onto an array...
                 if (checkboxes[i].checked) {
                    checkboxesChecked.push(checkboxes[i].value);
                    checkboxesType.push(checkboxes[i].getAttribute("data-type"));
                 }
             }
             len=checkboxesChecked.length
             if (checkboxesChecked.length != 0){

             for(var i = 0; i < checkboxesChecked.length; i++){
                checkedRows['id'+i] = checkboxesChecked[i] ;
                checkedRows['type'+i]= checkboxesType[i];
                //<!--alert(checkboxesChecked[i])-->
             }
             //console.log(checkedRows)
             $.ajax({
                type:'POST',
                url:'/selectbuyingmanagertable/'+len,
                data:checkedRows,
                success:function(response){
                    //console.log(response);
                    var data = JSON.parse(response)
                    updateMsg = data.message
                    showSnackbar(updateMsg);
                    buyingManagerTable.draw();
                    setTimeout(function(){
                        document.getElementById("showselectedbox").style.display= 'none';
                        if(data.code === 201){
                         location.reload();
                        }
                    },2000)
                },
                error:function(error) {
                    console.log(error);
                }
             });
             }else{
                showSnackbar("Please select at least one item.");
               }
             }
         }

         function deleteTableRows(operation){
             if(this.selectall != ""){
                swal({
                    title: "Are you sure?",
                    text: "Once deleted, you will not be able to recover this data!",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                }).then((willDelete) => {
                    if (willDelete) {
                        data = {"records":"total_record", "get_ids":true, "statusOperation":operation, "statusValue":this.status, "selectall":this.selectall, "retailerValue":this.retailer, "dateValue":this.dateValue, "assigneduser":this.assigneduser, "searchValue": getSeachValue(), 'unSelectArr':unSelectArr}
                        if ((data.statusValue != "" && data.statusValue != "Status") || (data.dateValue != "" && data.dateValue != "DateRange") || data.selectall != "" || (data.retailerValue != "" && data.retailerValue != 'Retailers') || (data.assigneduser != "" && data.assigneduser != "Assigned To")) {
                             $.ajax({
                                 type: "POST",
                                 //call the url with data
                                 url: "/selectalloperationbmforcount",
                                 data: JSON.stringify(data),
                                 success: function(d) {
                                    console.log('success', d);
                                    showSnackbar('Please wait...')
                                    d['selectall']= data['selectall']
                                    d['statusOperation']= data['statusOperation']
                                    //get all the id in response & send back to the giftcardcheckbalance url
                                    $.ajax({
                                          type: "post",
                                          url: "/buyingbulkaction",
                                          data: JSON.stringify(d),
                                          dataType: 'json',
                                          contentType: "application/json",
                                          success:function(msg) {
                                             removechecked();
                                             console.log(msg)
                                             buyingManagerTable.draw();
                                             showSnackbar(msg['message'])
                                          },
                                    });
                              },
                              dataType: 'json',
                              contentType: "application/json"
                           });
                       }
                   }
                });
            }
            else{
                var checkboxes = document.getElementsByName("check[]");
                var checkboxesChecked = [];
                var checkboxesType = [];
                var checkedRows={}
                checkedRows['status'] = operation;
                // loop over them all
                for (var i=0; i<checkboxes.length; i++) {
                   // And stick the checked ones onto an array...
                   if (checkboxes[i].checked) {
                      checkboxesChecked.push(checkboxes[i].value);
                      checkboxesType.push(checkboxes[i].getAttribute("data-type"));
                   }
                }
                if(checkboxesChecked.length !== 0){
                swal({
                    title: "Are you sure?",
                    text: "Once deleted, you will not be able to recover this data!",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                }).then((willDelete) => {
                    if (willDelete) {
                    len=checkboxesChecked.length
                    for(var i = 0; i < checkboxesChecked.length; i++){
                        checkedRows['id'+i] = checkboxesChecked[i] ;
                        checkedRows['type'+i]= checkboxesType[i];
                        //<!--alert(checkboxesChecked[i])-->
                    }
                 //console.log(checkedRows)
                 $.ajax({
                    type:'POST',
                    url:'/selectbuyingmanagertable/'+len,
                    data:checkedRows,
                    success:function(response){
                        //console.log(response);
                        var data = JSON.parse(response)
                        updateMsg = data.message
                        buyingManagerTable.draw();
                        showSnackbar(updateMsg);
                        setTimeout(function(){
                        document.getElementById("showselectedbox").style.display= 'none';
                        },2000)
                    },
                    error:function(error) {
                        console.log(error);
                    }
                 });
               }
             });
             }else{
                showSnackbar("Please select at least one item.");
             }
           }
       }
     </script>
    <!-- select and chnage multiple status in one time closed -->
    <!-- Update table using model on click & table value calculation -->
    <script type="text/javascript">
		function updateTotal(id){
            var totalAmount=0
            var subtotalAmount=0
            var loopValue=0
            data=document.getElementById("noRowUpdate").value
            Qty1=document.getElementById("updateTotalQty-1").value
            QtyPerCart1=document.getElementById("updateQtyPerCart-1").value
            loopValue=Qty1/QtyPerCart1
            if(Qty1%QtyPerCart1 != 0  ){
                document.getElementById("updateQtyPerCart-1").style.borderColor = "red";
                document.getElementById("updateTotalQty-1").style.borderColor = "red";
                document.getElementById("Warring-1").innerHTML = '&#9888; Please enter valid data ';
                //document.getElementById('save').disabled = true;
            }
            else{
                document.getElementById("updateQtyPerCart-1").style.borderColor = "";
                document.getElementById("updateTotalQty-1").style.borderColor = "";
                document.getElementById("Warring-1").innerHTML = '';
                //document.getElementById('save').disabled = false;
            }
            for(var x=1;x<=Number(data);x++){
                price=Number(document.getElementById("updatePrice-"+String(x)).value)
                Qty=document.getElementById("updateTotalQty-"+String(x)).value
                QtyPerCart=document.getElementById("updateQtyPerCart-"+String(x)).value
                var total=price*Qty
                totalAmount+=total
                var subtotal = price*QtyPerCart
                subtotalAmount+=subtotal
                //console.log('%',Qty%QtyPerCart)
                //console.log('/',Qty/QtyPerCart)
                //console.log('loopValue',loopValue)

                if(Qty%QtyPerCart==0 && Qty/QtyPerCart == loopValue && x >= 2 ){
                    document.getElementById("updateQtyPerCart-"+x).style.borderColor = "";
                    document.getElementById("updateTotalQty-"+x).style.borderColor = "";
                    document.getElementById("Warring-"+x).innerHTML = ' ';
                    //document.getElementById('save').disabled = false;
                }
                else{
                    if(x >= 2){
                        document.getElementById("updateQtyPerCart-"+x).style.borderColor = "red";
                        document.getElementById("updateTotalQty-"+x).style.borderColor = "red";
                        document.getElementById("Warring-"+x).innerHTML = '&#9888; Please enter valid data ';
                        //document.getElementById('save').disabled = true;
                        console.log('incorrect data')
                    }
                }
            }
            totalAmount = Math.round((totalAmount + Number.EPSILON) * 100) / 100
            subtotalAmount = Math.round((subtotalAmount + Number.EPSILON) * 100) / 100
            var subtotal = document.getElementById("updateTotalCart");
            $("#updateTotalCart").val(subtotalAmount);

            document.getElementById("display_total").style.color = '#CD5C5C'
            document.getElementById("update_display_total").value = totalAmount;
            document.getElementById("display_total").innerHTML = '  Total Amount: $'+String(totalAmount);
             // document.getElementById("TotalCart").value = totalAmount;
             //console.log(totalAmount)
         }

        function updatesubtotaltototal(e){
            var k = e.which;
            /* numeric inputs can come from the keypad or the numeric row at the top */
            if ( (k < 48 || k > 57) && (k < 96 || k > 105) && (k!= 8) && (k!= 46)) {
                e.preventDefault();
                return false;
            }else{
            var total_amount=0
            var subtotal=0
            var loop_value=0
            let qty=document.getElementById("updateTotalQty-1").value;
            let qty_per_cart=document.getElementById("updateQtyPerCart-1").value;
            qty = qty || 0
            qty_per_cart = qty_per_cart || 0
            loop_value= (qty/qty_per_cart)
            loop_value = loop_value || 0
            subtotal = document.getElementById("updateTotalCart").value;
            subtotal = subtotal || 0
            total_amount = Math.round(((loop_value * subtotal) + Number.EPSILON) * 100) / 100;
            document.getElementById("display_total").innerHTML = '   Total Amount: $'+String(total_amount);
            }
        }

        function total(id){
            var totalAmount=0
            var subtotalAmount=0
            var loopValue=0
            data=document.getElementById("noRow").value
            Qty1=document.getElementById("TotalQty-1").value
            QtyPerCart1=document.getElementById("QtyPerCart-1").value
            if(Qty1 !== "" && QtyPerCart1 !== ""){
            loopValue=Qty1/QtyPerCart1
            if(Qty1%QtyPerCart1 != 0  ){
                document.getElementById("QtyPerCart-1").style.borderColor = "red";
                document.getElementById("TotalQty-1").style.borderColor = "red";
                document.getElementById("Warring-1").innerHTML = '&#9888; Please enter valid data ';
                //document.getElementById('before_submit').disabled = true;
                console.log('incorrect data')
            }
            else{
                document.getElementById("QtyPerCart-1").style.borderColor = "";
                document.getElementById("TotalQty-1").style.borderColor = "";
                document.getElementById("Warring-1").innerHTML = '';
                //document.getElementById('before_submit').disabled = false;
            }
            for(var x=1;x<=Number(data);x++){
                price=Number(document.getElementById("Price-"+String(x)).value)
                Qty=document.getElementById("TotalQty-"+String(x)).value
                QtyPerCart=document.getElementById("QtyPerCart-"+String(x)).value
                var total=price*Qty
                var subtotal = price*QtyPerCart
                subtotalAmount+=subtotal
                totalAmount+=total
                //console.log('%',Qty%QtyPerCart)
                //console.log('/',Qty/QtyPerCart)
                //console.log('loopValue',loopValue)

                if(Qty%QtyPerCart==0 && Qty/QtyPerCart == loopValue && x >= 2 ){
                    document.getElementById("QtyPerCart-"+x).style.borderColor = "";
                    document.getElementById("TotalQty-"+x).style.borderColor = "";
                    document.getElementById("Warring-"+x).innerHTML = ' ';
                    //document.getElementById('before_submit').disabled = false;
                }
                else{
                    if(Qty !== "" && QtyPerCart !== ""){
                        if(x >= 2){
                            document.getElementById("QtyPerCart-"+x).style.borderColor = "red";
                            document.getElementById("TotalQty-"+x).style.borderColor = "red";
                            document.getElementById("Warring-"+x).innerHTML = '&#9888; Please enter valid data ';
                            //document.getElementById('before_submit').disabled = true;
                            //console.log('incorrect data')
                        }
                    }
                }
            }
            totalAmount = Math.round((totalAmount + Number.EPSILON) * 100) / 100
            subtotalAmount = Math.round((subtotalAmount + Number.EPSILON) * 100) / 100
            document.getElementById("display_total_add").innerHTML = '   Total Amount: $'+String(totalAmount);
             $("#TotalCart").val(subtotalAmount);
           }
         }

         function subtotaltototal(e){
            var k = e.which;
            /* numeric inputs can come from the keypad or the numeric row at the top */
            if ( (k < 48 || k > 57) && (k < 96 || k > 105) && (k!= 8) && (k!= 46)) {
                e.preventDefault();
                return false;
            }else{
            var total_amount=0
            var subtotal=0
            var loop_value=0
            let qty=document.getElementById("TotalQty-1").value;
            let qty_per_cart=document.getElementById("QtyPerCart-1").value;
            qty = qty || 0
            qty_per_cart = qty_per_cart || 0
            loop_value= (qty/qty_per_cart)
            loop_value = loop_value || 0
            subtotal = document.getElementById("TotalCart").value;
            subtotal = subtotal || 0
            total_amount = Math.round(((loop_value * subtotal) + Number.EPSILON) * 100) / 100;
            document.getElementById("display_total_add").innerHTML = '   Total Amount: $'+String(total_amount);
            }
        }

        var values = [];
		function dataList() {
			values.length = 0
			$('#userDataList :checked').each(function() {
				//if(values.indexOf($(this).val()) === -1){
				values.push($(this).val());
				//console.log(values)
			});
			data = document.getElementById("userDataList").value
			//console.log("data", data)
			if(data == 'All') {
				$('.userData').prop('disabled', true);
				$('.allValue').prop('disabled', false);
			} else {
				if(data != '') {
					$('.userData').prop('disabled', false);
					$('.allValue').prop('disabled', true);
				} else {
					$('.userData').prop('disabled', false);
					$('.allValue').prop('disabled', false);
				}
			}
		}

        var values = [];
		function dataListUpdate() {
			values.length = 0
			$('#updateUserDataList :checked').each(function() {
				//if(values.indexOf($(this).val()) === -1){
				values.push($(this).val());
				//console.log(values)
			});
			data = document.getElementById("updateUserDataList").value
			//console.log("data", data)
			if(data == 'All') {
				$('.userData').prop('disabled', true);
				$('.allValue').prop('disabled', false);
			} else {
				if(data != '') {
					$('.userData').prop('disabled', false);
					$('.allValue').prop('disabled', true);
				} else {
					$('.userData').prop('disabled', false);
					$('.allValue').prop('disabled', false);
				}
			}
		}

		// update data function updateTotalCart updatePaymentType updateShip updateLog updateUserDataList updatevendor

		var editbuyform = $('#edit_buyingmanager');
		editbuyform.submit(function (e) {
			e.preventDefault();
			data = {}
			retailers = document.getElementById("updateRetailers").value
			updateTotalCart = document.getElementById("updateTotalCart").value
			updatePaymentType = document.getElementById("updatePaymentType").value
			updateShip = document.getElementById("updateShip").value
			updateLog = document.getElementById("updateLog").value
			updateUserDataList = JSON.stringify(values)
			//console.log(typeof(updateUserDataList))
			updatevendor = document.getElementById("updatevendor").value
			len = $("#update-buying-items > div.row").length
			data["retailers"] = retailers
			data["totalCart"] = updateTotalCart
			data["paymentType"] = updatePaymentType
			data["updateShip"] = updateShip
			data["updateLog"] = updateLog
			data["updateUserDataList"] = updateUserDataList
			data["updatevendor"] = updatevendor
			data["lenValue"] = len
			data['cardID'] = document.getElementById("updateId").value
			for(var i = 1; i <= len; i++) {
				id = document.getElementById("dataID-" + String(i)).value
				sku = document.getElementById("updateSku-" + String(i)).value
				price = document.getElementById("updatePrice-" + String(i)).value
				qtyPerCart = document.getElementById("updateQtyPerCart-" + String(i)).value
				updateTotalQty = document.getElementById("updateTotalQty-" + String(i)).value
				data["sku" + String(i)] = sku
				data["price" + String(i)] = price
				data["qtyPerCart" + String(i)] = qtyPerCart
				data["updateTotalQty" + String(i)] = updateTotalQty
				data["dataID" + String(i)] = id
				console.log('data', data)
			}
			//console.log(data)
			$.ajax({
				type: editbuyform.attr('method'),
				url: editbuyform.attr('action'),
				data: data,
				success: function(response) {
					//console.log(response);
					//var table = $('#ptbldemo').DataTable();
					//table.ajax.reload();
					var data = JSON.parse(response);
					if(data.code===200){
					    $('#con-close-modal-1').modal('toggle');
					    showSnackbar('Data updated.');
					    buyingManagerTable.draw();
					}else{
					    $('#con-close-modal-1').modal('toggle');
					    showSnackbar('Having some issue please contact from superier.');
					    console.log(data.status);
					}

				},
				error: function(error) {
					console.log(error);
				}
			});
		});
    </script>
    <!-- Update table using model on click & table value calculation closed -->
    <!-- Edit model functionality and show model   -->
    <script>
    function edit_cart(element){
			var edit_data = element.dataset;
			//console.log(edit_data.id);
			$.ajax({
                  type: "POST",
                  url: '/editbuyingmanger?id='+edit_data.id,
                  success: function(result) {
                        document.getElementById('error').innerText = ""
				        document.getElementById("display_total").innerText = ""
				        document.getElementById("updateTotalCart").style.borderColor = "";
				        document.getElementById('save').disabled = false
				        $('#updateUserDataList').val([]);
						// Declare variables for carts
						if (result.message == undefined){
						var product_detail = result.product_detail
						var cart_detail = result.cart_detail
						var shipping_detail = result.shipping_user
						var user_detail = result.user_data;
						var wrapper = $("#update-buying-items");
						var x = 0;
						$(wrapper).empty();
						// cart value set -------

						$("#updateRetailers").val(cart_detail.retailler);
						$("#updateTotalCart").val(cart_detail.cart_total);
						$("#updatevendor").val(cart_detail.vendor);
						var item_list = ['Bass','Home Depot','Kohls']
						let updatevendor = $("#updatevendor").find('option')[3]
						if(!item_list.includes(cart_detail.retailler)){
						  $(updatevendor).hide();
						}else{
						  $(updatevendor).show();
						}
						$("#updatePaymentType").val(cart_detail.payment_type).trigger('change');
						$("#updateId").val(cart_detail.cart_id);

						$("#updateLog").val(shipping_detail.login_id).trigger('change');
						$("#updateShip").val(shipping_detail.shipping_place).trigger('change');
						user_data = []
						// set user details
						for (var i=0; i<user_detail.length; i++)
						{
						 if (user_detail[i].status === true) {
						     user_data.push(user_detail[i].id)
						 }
						}
						if (user_data.length !== 0){
						    $("#updateUserDataList").val(user_data).trigger('change');
						}

						// set item sku details
						$.each(product_detail, function(key, item)
                        {
                          x++; //text box increment
                          document.getElementById("noRowUpdate").value=x
                          $(wrapper).append('<input type="text" hidden name="dataID-'+x+'" id="dataID-'+x+'" value="'+item.id+'">'+
                          '<div class="row">'+
                             '<div class="col-md-3">'+
                               '<div class="form-group">'+
                                  '<label for="field-2" class="control-label">Item Sku </label>'+
                                  '<input required readonly type="text" class="form-control space_not_allow" value="'+item.item_sku+'"  name="Sku-'+x+'" id="updateSku-'+x+'" placeholder="3452" pattern="\S+" title="This field is required">'+
                               '</div>'+
                             '</div>'+
                             '<div class="col-md-3">'+
                                '<div class="form-group">'+
                                   '<label for="field-3" class="control-label">Price</label>'+
                                   '<input required type="number" step="any" min="0" class="form-control" value="'+item.price+'" name="Price-'+x+'" id="updatePrice-'+x+'" onkeyup="updateTotal(id)" placeholder=" $29">'+
                                '</div>'+
                             '</div>'+
                             '<div class="col-md-3">'+
                                '<div class="form-group">'+
                                   '<label for="field-4" class="control-label">Qty Per Cart</label>'+
                                   '<input required type="number" step="number" min="0" class="form-control" value="'+item.qty_per+'" name="QtyPerCart-'+x+'" id="updateQtyPerCart-'+x+'" onkeyup="updateTotal(id)" placeholder="1">'+
                                '</div>'+
                             '</div>'+
                             '<div class="col-md-3">'+
                                '<div class="form-group">'+
                                   '<label for="field-5" class="control-label">Total Qty</label>'+
                                   '<input required type="number" step="number" min="0" class="form-control" value="'+item.qty_tot+'" name="TotalQty-'+x+'" id="updateTotalQty-'+x+'" onkeyup="updateTotal(id)" placeholder="10">'+
                                '</div>'+
                             '</div>'+
                         '</div>'+
                         '<h5><span style="color:red" id="Warring-'+x+'"></span></h5>');
                        });
                   }else{
                        $('#con-close-modal-1 .close').click()
                        showSnackbar(result.message);
                   }
				  },
                  dataType: 'json',
                  contentType: "application/json",
                });
		}
    </script>
    <!--  Edit CART VALUE  END EDIT -->
    <!--  Remove table  row  -->
    <script>
        function deleteRow(row_num,element) {
            var  id_data = row_num.replace("d-", "");
            var data = {
                "row_num": id_data
            }
            swal({
                title: "Are you sure?",
                text: "Once deleted, you will not be able to recover this data!",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            }).then((willDelete) => {
                if (willDelete) {
                    var row_info = [];
                    const tr = $(element).parent().parent();;
                    row_info.push(tr)
                    $.ajax({
                        type: "DELETE",
                        url: "/detailbuyingmanger",
                        data: JSON.stringify(data),
                        dataType: 'json',
                        contentType: "application/json",
                        success: function(d) {
                            if (d.code == 400) {
                                showSnackbar("Can't deleted.")
                            } else {
                                tr.remove();
                                showSnackbar("Record deleted.")
                                buyingManagerTable.draw();
                            }
                        },
                        error: function(xhr, ajaxOptions, thrownError) {
                            swal("Error deleting!", "Please try again", "error");
                        }
                    });
                }
            });
        }
   //-------------------------function end deleting row --------------------//
	</script>
    <!-------------- all top select filters comes here -------------------->
    <script type="text/javascript">
       function getSeachValue(){
          return $('.dataTables_filter input').val().trim()
       }

       //this function is for select all button
       selectall = ''
       this.selectall_data = '';
       total_selected_record = 0;
       total_records_count = 0;
       function selectAll(id){
          let id_select = id

          if(buyingManagerTable.$('tr').hasClass('selected')) {
             this.selectall_data = '';
             selectall = "";
             unSelectArr = [];
             $('#'+id_select).text("Select All");
             buyingManagerTable.rows().deselect();
             $(".cb-tab").prop("checked", false)
             $(".cb-single").prop("checked", false)

             //this line hide checkbox message
             document.getElementById("showselectedbox").style.display= 'none';
             showSnackbar("You’ve De-Selected All Items")
          } else {
             $('#'+id_select).text("De-Select All");
             buyingManagerTable.rows().select();
             selectall = "allrecords"
             $(".cb-tab").prop("checked", true)
             $(".cb-single").prop("checked", true)

            //this line hide checkbox message
            document.getElementById("showselectedbox").style.display= 'none';

            this.selectall_data = {"records":"total_record", "get_ids":false, "statusOperation":status, "statusValue":this.status, "selectall":this.selectall, "retailerValue":this.retailer, "dateValue":this.dateValue, "assigneduser":this.assigneduser, "searchValue": getSeachValue(), 'unSelectArr':unSelectArr}
            $.ajax({
                  type: "POST",
                  url: "/selectalloperationbmforcount",
                  data: JSON.stringify(this.selectall_data),
                  success: function(d) {
                     console.log('Success', d);
                     total_selected_record = d['total_record']
                     total_records_count = d['total_record']
                     calculateChecked();
                     showSnackbar("You’ve Selected "+ d['total_record'] + " Items")
                  },
                  dataType: 'json',
                  contentType: "application/json"
            });
          }
       }

       function selectAllShow(){
             buyingManagerTable.rows().select();
             selectall = "allrecords"
             $(".cb-tab").prop("checked", true)
             $(".cb-single").prop("checked", true)

             for (id of unSelectArr) {
                // find checkbox by value
                const checkbox = document.querySelector("input[value='" + id + "']");
                // uncheck this checkbox because its unselected
                if (checkbox) {
                   $(checkbox).prop("checked", false)
                }
             }

             //this thing work when selectall first then filter
             //then it show message on mini checkbox
             //data = {"records":"total_record", "statusValue":this.status, "vendorValue":this.vendor, "dateValue":this.dateValue,"retailerValue":this.retailer, "archive":this.isArchive, "addforsale":false, 'checkbalance':false, 'createbarcode':false, 'unSelectArr':unSelectArr}
             data = {"records":"total_record", "get_ids":false, "statusOperation":status, "statusValue":this.status, "selectall":this.selectall, "retailerValue":this.retailer, "dateValue":this.dateValue, "assigneduser":this.assigneduser, "searchValue": getSeachValue(), 'unSelectArr':unSelectArr}
             if ((data.statusValue != "" && data.statusValue != "Status") || (data.dateValue != "" && data.dateValue != "DateRange") || data.selectall != "" || (data.retailerValue != "" && data.retailerValue != 'Retailers') || (data.assigneduser != "" && data.assigneduser != "Assigned To")) {
                   $.ajax({
                         type: "POST",
                         url: "/selectalloperationbmforcount",
                         data: JSON.stringify(data),
                         success: function(d) {
                            console.log('Success', d);
                            total_selected_record = d['total_record']
                            calculateChecked()
                            //if (unSelectArr.length == 0){
                            //   showSnackbar("You’ve Selected "+ d['total_record'] + " Items")
                            //}
                         },
                         dataType: 'json',
                         contentType: "application/json"
                   });
             }

       }
       /*
       function selectAll(id){
          let id_select = id
          if(buyingManagerTable.$('tr').hasClass('selected')) {
             this.selectall = ''
             $('#'+id_select).text("Select All");
             buyingManagerTable.rows().deselect();
             $(".cb-tab").prop("checked", false)
             $(".cb-single").prop("checked", false)
             //alert( buyingManagerTable.rows('.selected').data().length +' row(s) deselected' );
             showSnackbar('All Records De-Selected')
          } else {
             $('#'+id_select).text("De-Select All");
             buyingManagerTable.rows().select();
             //alert( buyingManagerTable.rows('.selected').data().length +' row(s) selected' );
             this.selectall = "allrecords"
             $(".cb-tab").prop("checked", true)
             $(".cb-single").prop("checked", true)
             //this line hide checkbox message
             document.getElementById("showselectedbox").style.display= 'none';
             var data = {"records":"total_record","statusOperation":status,"statusValue":this.status, "selectall":this.selectall, "retailerValue":this.retailer, "dateValue":this.dateValue, "assigneduser":this.assigneduser, "searchValue": getSeachValue()}
             $.ajax({
                    type: "post",
                    url: "/selectalloperationbmforcount",
                    data: JSON.stringify(data),
                    success: function(data) {
                        if (data['code'] == 200){
                          showSnackbar("You’ve Selected "+ data['total_record'] + " Items")
                        }else{
                          showSnackbar(data['error'])
                        }
                       },
                    dataType: 'json',
                    contentType: "application/json"
              });
          }
       }
       */

       //function for the filtering the retailer from the upperdropdown
       this.retailer = '';
       function retailerFilter(selectedRetailer) {
          this.retailer = selectedRetailer.value;
          //console.log('selectedRetailer-', this.retailer);
          // and filter process will automatically manage by datatable
          buyingManagerTable.columns(3).search(this.retailer).draw();
       }
       //---------function end retailerFilter-------------//

       //------------------- Assigned user filter ----- //
       this.assigneduser = '';
       function assignedto(seletedUser){
          this.assigneduser = seletedUser.value;
          //console.log('selectedUser', this.assigneduser);
          buyingManagerTable.draw();
       }
       //------------------- Assigned user filter ----- //

       //function for the filtering the status from the upperdropdown
       this.status = '';
       function statusFilter(selectedStatus){
       this.status = selectedStatus.value;
       //console.log('selectedStatus', this.status)
       buyingManagerTable.columns(11).search(this.status).draw();
       }
       //---------function end statusFilter-------------//

       //function for the filtering the date from the upperdropdown
       this.dateValue='';
       function dateFilter(filteredDate){
            //get value of vendor from the filter
             this.dateValue = filteredDate.value;
             //console.log(this.dateValue)

             if (this.dateValue != 'Custom'){
                //console.log('selectedStatus', this.dateValue)
                document.getElementById("showcustomdate").style.display= 'none';
                buyingManagerTable.columns(2).search(this.dateValue).draw();
             }
             else{
                if (this.dateValue == 'Custom'){
                 $("#timefilter").find('option[value="DateRange"]').prop("selected", true);
                 $("#modal-date-custom").modal("show");
                }
             }
       }

       //get model pop date range and send to the datatable through search value
       function customDate(){
         let date1=document.getElementById("dp-from").value
         let date2=document.getElementById("dp-to").value
         if(date1 == "" || date2 == ""){
          return
         }else{
          $('#dateButton').attr("data-dismiss","modal");
         }
         //   console.log(date1)
         //   console.log(date2)
         this.dateValue = ["Custom", date1, date2]
         //  this is used for displaying the custom date range
         let customdate = ["<b>Date Range</b>: " + date1 + " to " + date2];
         document.getElementById("showcustomdate").innerHTML = customdate;
         document.getElementById("showcustomdate").style.display= 'inline';
         //this is used for date table code
         buyingManagerTable.columns(2).search([this.dateValue]).draw()
       }
    </script>
    <script>
      var buyingform = $('#buyingManagerForm');
      buyingform.submit(function (e) {
      e.preventDefault();
      $.ajax({
				type: buyingform.attr('method'),
				url: buyingform.attr('action'),
				data: $(buyingform).serialize(),
				success: function(response) {
					var data = JSON.parse(response);
					$('#Retailers').find('option').prop("disabled", false);
					$('#vendor').find('option').prop("disabled", false);
					if (data.status == 200){
					    $("#buyingManagerForm")[0].reset();
					    $('#con-close-modal').modal('toggle');
					    showSnackbar(data.messages);
					    //buyingManagerTable.draw(false);
					    setTimeout(function(){
                               location.reload();
                         },1000)
					}else if(data.status == 404){
					    showSnackbar(data.messages);
					}
					console.log(data)
				},
				error: function(error) {
					console.log(error);
				}
			});
        });
    </script>
    <script>
        $('#Retailers').change(function() {
             var current_val = $(this).val()
             var vendor = $('#vendor').find('option')
             var item_list = ['Bass','Home Depot','Kohls']
             if (item_list.includes(current_val)){
                $(vendor[3]).show();
             }else{
                $(vendor[3]).hide();
                $(vendor[0]).prop('selected', true);
             }
        })
        $('#vendor').change(function() {
           var current_val = $(this).val()
           var retailer = $('#Retailers').find('option')
           var item_list = ['Bass','Home Depot','Kohls']
           for(let i=0; i<retailer.length; i++){
             if(current_val === 'iConsumer'){
                 if(!item_list.includes(retailer[i].text)){
                    $(retailer[i]).hide();
                 }
             }else{
                  $(retailer[i]).show();
             }
           }
        })
    </script>

    <!----------------------------- end comment --------------------------------->
    {% endblock %}