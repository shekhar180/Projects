{% extends "extend.html" %}
{% block tittle %}User List- ECOMMFLOW{% endblock tittle %}
{% block css %}
<link rel="stylesheet" type="text/css" href="static/css/addaccount.css">
<!-- third party css -->
<link href="static/libs/datatables/dataTables.bootstrap4.css" rel="stylesheet" type="text/css"/>
<link href="static/libs/datatables/responsive.bootstrap4.css" rel="stylesheet" type="text/css"/>
<link href="static/libs/datatables/buttons.bootstrap4.css" rel="stylesheet" type="text/css"/>
<link href="static/libs/datatables/select.bootstrap4.css" rel="stylesheet" type="text/css"/>
<!-- third party css end -->
<style>
    #snackbar {
	visibility: hidden;
	min-width: 250px;
	margin-left: -125px;
	background: #f7b84b !important;
	z-index: 999 !important;
	color: #000 !important;
	text-align: center;
	border-radius: 2px;
	padding: 16px;
	position: fixed;
	z-index: 1;
	left: 50%;
	top: 30px;
	font-size: 17px;
}

#snackbar.show {
    z-index: 10000!important;
	visibility: visible;
	-webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
	animation: fadein 0.5s, fadeout 0.5s 2.5s;
}

@-webkit-keyframes fadein {
	from {
		top: 0;
		opacity: 0;
	}
	to {
		top: 30px;
		opacity: 1;
	}
}

@keyframes fadein {
	from {
		top: 0;
		opacity: 0;
	}
	to {
		top: 30px;
		opacity: 1;
	}
}

@-webkit-keyframes fadeout {
	from {
		top: 30px;
		opacity: 1;
	}
	to {
		top: 0;
		opacity: 0;
	}
}

@keyframes fadeout {
	from {
		top: 30px;
		opacity: 1;
	}
	to {
		top: 0;
		opacity: 0;
	}
}
/* Show Loader CSS */
.dataTables_processing {
        top: 0px !important;
        left: 0px !important;
        width: 100% !important;
        margin-left: 0px !important;
        margin-top: 0px !important;
        z-index: 80 !important;
        padding: 16em 0 !important;
        overflow-y: hidden;
}
@keyframes spinner {
  to {transform: rotate(360deg);}
}

.spinner{
    width:100px !important;
    height:100px !important;
    top: -150px !important;
}

.spinner:before {
  box-sizing: border-box;
  position: absolute;
  left: 50%;
  width:100%;
  height: 20px;
  margin-top: -10px;
  margin-left: -10px;
  border-radius: 50%;
  border: 2px solid #ccc;
  border-top-color: #333;
  z-index:9999;
  animation: spinner .6s linear infinite;
}
/* Show Loader CSS CLOSED */
</style>
{% endblock css %}
 {% block js %}
 <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
<!-- third party js -->
<script src="static/libs/datatables/jquery.dataTables.min.js"></script>
<script src="static/libs/datatables/dataTables.bootstrap4.js"></script>
<script src="static/libs/datatables/dataTables.responsive.min.js"></script>
<script src="static/libs/datatables/responsive.bootstrap4.min.js"></script>
<script src="static/libs/datatables/dataTables.buttons.min.js"></script>
<script src="static/libs/datatables/buttons.bootstrap4.min.js"></script>
<script src="static/libs/datatables/buttons.html5.min.js"></script>
<script src="static/libs/datatables/dataTables.keyTable.min.js"></script>
<script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
<!-- Datatables init -->
<script src="static/js/pages/datatables.init.js"></script>


        <!-- Bootstrap Tables js -->
        <script src="static/libs/bootstrap-table/bootstrap-table.min.js"></script>

        <!-- Init js -->
        <script src="static/js/pages/bootstrap-tables.init.js"></script>

        <!-- Sweetalert -->
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

        <!-- App js -->
        <script src="static/js/app.min.js"></script>
 {% endblock js %}
{% block body %}
            <!-- ============================================================== -->
            <!-- Start Page Content here -->
            <!-- ============================================================== -->
<div id="snackbar">Some text some message..</div>
            <div class="content-page">
                <div class="content">

                    <!-- Start Content-->
                    <div class="container-fluid">

                        <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box">

                                    <h4 class="page-title">User List</h4>
                                </div>
                            </div>
                        </div>
                        <!-- end page title -->



                        <div class="row">
                            <div class="col-sm-12">
                                <div class="card-box">

                                    

                                    <div class="row">
                                        <div class="col-md-1 mb-2 ">

                                            <button onclick="deleteRows()" class="btn btn-danger waves-effect waves-light">Delete</button>
                                        </div>
                                        <div class="col-md-2 ">
                                           <select name="selector" class="selectpicker">
                                                <option>Active</option>
                                                <option>Non Active</option>
                                            </select>
                                        </div>
                                    </div>


                                    <table id="userTable" class="table w-100 table-bordered nowrap table-hover">
                                        <thead class="thead-light">
	                                        <tr>
                                                <th class="no-sort"><input type="checkbox" name="check1" id="cb-bulk" class="cb-tab"></th>
                                                <th>Start Date</th>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Modules Active</th>
                                                <th>Status</th>
                                                <th>Edit</th>
                                            </tr>
                                        </thead>
                                    </table>
                                    <!--
                                    <table id="userTable" data-toggle="table"
                                           data-page-size="5"
                                           data-buttons-class="xs btn-light"
                                           data-pagination="true" class="table-bordered ">
                                        <thead class="thead-light">
                                        <tr>
                                            <th><input type="checkbox" name="check1" id="cb-bulk" class="cb-tab"></th>
                                            <th data-field="date" data-sortable="true" data-formatter="dateFormatter">Start Date</th>
                                            <th data-field="name" data-sortable="true">Name</th>
                                            <th data-field="Email" data-sortable="true">Email</th>
                                            <th data-sortable="true">Modules Active</th>
                                            <th data-field="status" data-align="center" data-sortable="true" data-formatter="statusFormatter">Status</th>
                                            <th data-sortable="true">Edit</th>
                                        </tr>
                                        </thead>


                                        <tbody>

                                        {% for x in userlist %}
                                        <tr>
                                            <td><input type="checkbox" name="check[]" value="{{x.id}}" class="cb-single"></td>
                                            <td>{{x.creationDate}}</td>
                                            <td>{{x.contactName}}</td>
                                            <td>{{x.Email}}</td>
                                            <td>{{x.activeModel}}</td>

                                            <td><label class="switch"><input {% if 1 == x.status%} checked {%endif%} type="checkbox" id="status{{x.userid}}" onchange="statusFunction({{x.userid}})"><span class="slider round"></span></label></td>
                                            <td>
                                              <form action="/edituser" method="post">
                                                  <button value={{x.userid}} name="button"  class="btn btn-info waves-effect waves-light">Edit</button>
                                              </form>
                                            </td>

                                        </tr>
                                        {% endfor %}
                                        </tbody>
                                        

                                    </table> -->
                                </div> <!-- end card-box-->
                            </div> <!-- end col-->
                        </div>
                        <!-- end row-->

                    </div> <!-- container -->

                </div>
                <!-- content -->
                <script src="static/js/vendor.min.js"></script>
                <script type="text/javascript">
                    function showSnackbar(text) {
                        var x = document.getElementById("snackbar");
                        x.innerHTML = text;
                        x.className = "show";
                        setTimeout(function(){ x.className = x.className.replace("show", ''); }, 3000);
                    }
                </script>
                <script type="text/javascript">
                   $(document).ready(function(){
                        function checkfirstcolumn(){
                            if($(".no-sort").hasClass("sorting_asc")){
                                $(".no-sort").removeClass("sorting_asc");
                            }
                            setTimeout(function(){
                            checkfirstcolumn();
                            },1000)}
                       checkfirstcolumn();
                   });
                   function showTableLoader(){
                        $(".dataTables_processing").show(0);
                        return true;
                   }
                   function hideTableLoader(){
                       $(".dataTables_processing").hide(0);
                       return false;
                   }
                   function removeChecked(){
                        $(".cb-single").prop("checked", false);
                        $(".cb-tab").prop("checked", false);
                   }
                </script>
                <script>
                      var userTableList = undefined;
                      $(document).ready(function() {
                         //this code work when you refresh the page
                         if (performance.navigation.type != 2){
                         //checks if page is accessed through a link or refresh
                             userTableList = $('#userTable').DataTable();
                             userTableList.state.clear();
                             userTableList.destroy(); // need to destroy the table, I don't know why..
                          }
                          // table initialization code
                          userTableList = $('#userTable').DataTable({
                               serverSide: true,
                               processing: true,
                               'language': {
                                    'loadingRecords': '&nbsp;',
                                    'processing': '<div class="spinner"></div>'
                               },
                               searching: true,
                               columns: [{
                                        data: "",
                                        "orderable":false,
                                        "render": function(data, type, row, meta) {
                                            return '<input type="checkbox" name="check[]" value="' + row.Id + '" class="cb-single">'
                                        }
                                    },{
                                        "data": "Date"
                                    },{
                                        "data": "Name"
                                    },{
                                        "data": "Email"
                                    },{
                                        "data": "Model"
                                    },{
                                        "data": "Status",
                                        "render": function(data, type, row, meta) {
                                            if (row.Status == 1) {
                                                return '<label class="switch"><input checked  type="checkbox" id="status' + row.Id + '" onchange="statusFunction(id)"><span class="slider round"></span></label>'
                                            } else {
                                                return '<label class="switch"><input  type="checkbox" id="status' + row.Id + '" onchange="statusFunction(id)"><span class="slider round"></span></label>'
                                            }
                                        }
                                    },{
                                        "data": "Edit",
                                        "orderable":false,
                                        "render": function(data, type, row, meta) {
                                             let htmlcontent = `<form action="/edituser" method="post">
                                                  <button value="`+row.Id+`" name="button"  class="btn btn-info waves-effect waves-light">Edit</button>
                                              </form>`
                                            return htmlcontent
                                     }
                                  }
                               ],
                               "ajax": {
                               'type': 'post',
                               'url': '/userlist',
                               'dataType': 'json',
                               "contentType": "application/json",
                               error: function (jqXHR, textStatus, errorThrown) {
                                console.log(textStatus, "Server Busy, Loading data, Please try again...")
                               },
                               "data": function ( d ) {
                                           console.log(d)
                                           showTableLoader();
                                           return JSON.stringify(d)
                                     }
                               },
                               "drawCallback": function( settings ) {
                                   hideTableLoader();
                               }
                            })
                      });
                </script>
<script>
    function deleteRows(){
          var checkboxes = document.getElementsByName("check[]");
          var checkboxesChecked = [];
          var checkedRows={}

          // loop over them all
          for (var i=0; i<checkboxes.length; i++) {
             // And stick the checked ones onto an array...
             if (checkboxes[i].checked) {
                checkboxesChecked.push(checkboxes[i].value);
             }
          }
           len=checkboxesChecked.length
           if (len !== 0){
           for(var i = 0; i < checkboxesChecked.length; i++){
             checkedRows['id'+i] = checkboxesChecked[i] ;
           }

           $.ajax({
              type:'POST',
              url:'/deleteUser/'+len,
              data:checkedRows,
              success:function(response){
              var data = JSON.parse(response)
              showSnackbar(data.msg)
              removeChecked();
              console.log(response);
              userTableList.draw()
              },
              error:function(error) {
              console.log(error);
              }
           });
           }else{
             showSnackbar("Please select at least one item.");
           }
     }
</script>
<script type="text/javascript">
$(document).on("click", "#cb-bulk", function(){
	$(".cb-single").prop("checked", $(this).prop("checked"));
});

$(document).on("click", ".cb-single", function(){
	var all = $(".cb-single").length;

	var checked = $(".cb-single:checked").length;

	if(all == checked){
		$(".cb-tab").prop("checked", true);
	}else{
		$(".cb-tab").prop("checked", false);
	}
});
</script>
<script type="text/javascript">
function statusFunction(idData) {
    id = String(idData).slice(6)
    $.ajax({
    type:'POST',
    url:'/statusChange/'+id,
    data:{
           status: $('input#'+idData).prop('checked')
    },
    success:function(data){
       showSnackbar(data.data)
       //userTableList.draw(false);
       console.log(data);
       }
    });
}
</script>

<script type="text/javascript">
/*
   $( document ).ready(function() {
      $('.metismenu li').removeClass('active');
      $('.metismenu ul').removeClass('in');
   });
   $(".button-menu-mobile").click(function () {
        $('.metismenu li').removeClass('active');
        $('.metismenu ul').removeClass('in');
   });  */
</script> 
{% endblock %}
